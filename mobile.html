<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redirecting...</title>
</head>

<body>
    <script type="text/javascript">
        document.addEventListener("DOMContentLoaded", function () {
            var userAgent = navigator.userAgent || navigator.vendor || window.opera;
            var currentUrl = window.location.href;
            var urlParams = new URLSearchParams(window.location.search);

            // Base Universal Link
            var baseUniversalLink = "https://bejewelled-alfajores-fe0e2f.netlify.app/open-app?redirect=fake";
            var universalLink = baseUniversalLink + (urlParams.toString() ? "&" + urlParams.toString() : "");

            var urlScheme = "mmtravel://open-app"; // **Fallback URL Scheme**

            var appStoreLink = "https://apps.apple.com/app/id1208542183";
            var playStoreLink = "https://play.google.com/store/apps/details?id=mmv.mmtravelE";
            var storeLink = /iPad|iPhone|iPod/.test(userAgent) ? appStoreLink : playStoreLink;

            var startTime = Date.now();

            // **1. Open the Universal Link in a new tab**
            var newTab = window.open(universalLink, "_blank");

            // **2. If the new tab could not be opened (blocked by browser), try URL Scheme**
            setTimeout(function () {
                if (!newTab || newTab.closed) {
                    window.location.href = urlScheme;
                }
            }, 1000);

            // **3. After 2 seconds, check if the user is still on the page**
            setTimeout(function () {
                var elapsedTime = Date.now() - startTime;

                if (elapsedTime < 1500) {
                    // If the user has left the browser (app opened), cancel store redirect
                    return;
                }

                // **4. If the app did not open, redirect the user to the App Store / Google Play**
                window.location.href = storeLink;
            }, 2000);
        });
    </script>
</body>

</html>